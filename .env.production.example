# ServalSheets Production Environment Configuration
#
# ‚ö†Ô∏è  PRODUCTION DEPLOYMENT CONFIGURATION
# This file contains production-optimized defaults and security recommendations.
# Copy to .env and configure with your actual values.

# ============================================================================
# üîê SECURITY-CRITICAL SECRETS (REQUIRED)
# ============================================================================
# ‚ö†Ô∏è  WARNING: Generate unique secrets for production. Never use example values!
# Generate with: openssl rand -hex 32

# JWT signing secret (REQUIRED in production)
# Used for signing OAuth access tokens
JWT_SECRET=REPLACE_WITH_32_BYTE_HEX_SECRET

# OAuth state HMAC secret (REQUIRED in production)
# Used for CSRF protection in OAuth flow
STATE_SECRET=REPLACE_WITH_32_BYTE_HEX_SECRET

# OAuth client secret (REQUIRED in production)
# Used for OAuth client authentication
OAUTH_CLIENT_SECRET=REPLACE_WITH_32_BYTE_HEX_SECRET

# Token encryption key (REQUIRED for encrypted token storage)
# Must be exactly 64 hex characters (32 bytes)
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=REPLACE_WITH_32_BYTE_HEX_SECRET

# ============================================================================
# üåê ENVIRONMENT & SERVER
# ============================================================================

# Environment mode (MUST be 'production' for production deployments)
NODE_ENV=production

# Server configuration
PORT=3000
HTTP_PORT=3000
# Bind to all interfaces in production (ensure firewall is configured)
HOST=0.0.0.0

# ============================================================================
# üîë OAUTH CONFIGURATION
# ============================================================================

# OAuth issuer (your server's public URL)
OAUTH_ISSUER=https://servalsheets.yourdomain.com

# OAuth client ID
OAUTH_CLIENT_ID=servalsheets

# Token TTLs (production-optimized)
ACCESS_TOKEN_TTL=3600        # 1 hour
REFRESH_TOKEN_TTL=604800     # 7 days (more secure than 30 days default)

# ============================================================================
# üîê GOOGLE API CREDENTIALS
# ============================================================================

# Google OAuth credentials from https://console.cloud.google.com
GOOGLE_CLIENT_ID=your-project-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret

# ============================================================================
# üîí SECURITY & CORS
# ============================================================================

# Allowed OAuth redirect URIs (comma-separated whitelist)
# ‚ö†Ô∏è  CRITICAL: Only include trusted domains. No wildcards!
ALLOWED_REDIRECT_URIS=https://servalsheets.yourdomain.com/callback,https://claude.ai/callback

# CORS origins (comma-separated whitelist)
# ‚ö†Ô∏è  NEVER use '*' in production!
CORS_ORIGINS=https://claude.ai,https://claude.com,https://servalsheets.yourdomain.com

# ============================================================================
# üíæ SESSION STORAGE (Production: Use Redis)
# ============================================================================

# Session store type
# ‚ö†Ô∏è  Use 'redis' in production, NOT 'memory' (memory doesn't scale)
SESSION_STORE_TYPE=redis

# Redis URL (required when SESSION_STORE_TYPE=redis)
REDIS_URL=redis://localhost:6379

# ============================================================================
# üìä OBSERVABILITY (Production-Optimized)
# ============================================================================

# Logging level (production: info, staging: debug)
LOG_LEVEL=info

# OpenTelemetry distributed tracing (enabled by default for production observability)
TRACING_ENABLED=true
TRACING_SAMPLE_RATE=0.1      # 10% sampling (adjust based on traffic volume)

# Structured logging format
LOG_FORMAT=json              # JSON for production log aggregation

# ============================================================================
# ‚ö° PERFORMANCE & RATE LIMITING (Production-Optimized)
# ============================================================================

# Request timeouts (production-optimized)
REQUEST_TIMEOUT_MS=60000               # 60 seconds (longer for complex operations)
GRACEFUL_SHUTDOWN_TIMEOUT_MS=30000     # 30 seconds (enough time to drain requests)

# Concurrency limits
MAX_CONCURRENT_REQUESTS=100            # Higher for production traffic
DEFAULT_CONCURRENCY=10                 # Per-tool concurrency

# Rate limiting (adjusted for production volume)
RATE_LIMIT_TOKENS=1000                 # Higher capacity
RATE_LIMIT_INTERVAL_MS=60000           # 1 minute window
RATE_LIMIT_MAX_BURST=150               # Allow bursts

# Request deduplication
DEDUP_ENABLED=true
DEDUP_WINDOW_MS=5000                   # 5 seconds

# ============================================================================
# üîÑ CIRCUIT BREAKER (Resilience)
# ============================================================================

CIRCUIT_BREAKER_FAILURE_THRESHOLD=10   # Higher threshold for production
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3    # More conservative recovery
CIRCUIT_BREAKER_TIMEOUT_MS=60000       # 60 seconds timeout

# ============================================================================
# üì¶ BATCH OPERATIONS (Production-Optimized)
# ============================================================================

# Batching configuration
DEFAULT_BATCH_SIZE=100                 # Larger batches in production
DEFAULT_BATCH_DELAY_MS=50              # Shorter delay for lower latency
MIN_BATCH_SIZE=10                      # Minimum for efficiency
ADAPTIVE_BATCHING_ENABLED=true         # Auto-tune based on traffic

# ============================================================================
# üóÑÔ∏è STORAGE & CACHING
# ============================================================================

# Token storage (use encrypted file storage in production)
GOOGLE_TOKEN_STORE_PATH=/var/lib/servalsheets/tokens.encrypted

# Schema caching
SCHEMA_CACHE_TTL_MS=3600000            # 1 hour
SCHEMA_CACHE_MAX_ENTRIES=1000

# Metadata caching
METADATA_CACHE_TTL_MS=300000           # 5 minutes
METADATA_CACHE_MAX_ENTRIES=500

# ============================================================================
# üîç HEALTH CHECKS
# ============================================================================

# Health check configuration
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL_MS=30000         # Check every 30 seconds
HEALTH_CHECK_TIMEOUT_MS=5000           # 5 second timeout

# ============================================================================
# üìà METRICS & MONITORING
# ============================================================================

# Metrics endpoint (disable if using pull-based monitoring)
METRICS_ENABLED=true
METRICS_PORT=9090                      # Prometheus default

# Payload size monitoring
PAYLOAD_WARNING_THRESHOLD_MB=5         # Warn on large payloads
PAYLOAD_MAX_SIZE_MB=50                 # Hard limit

# ============================================================================
# üîê ADDITIONAL SECURITY HEADERS
# ============================================================================

# Content Security Policy
CSP_DIRECTIVES="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https://sheets.googleapis.com; frame-ancestors 'none';"

# Strict Transport Security
HSTS_MAX_AGE=31536000                  # 1 year
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# ============================================================================
# üìù DEPLOYMENT NOTES
# ============================================================================
#
# Pre-Deployment Checklist:
# ‚úÖ Replace ALL placeholder secrets with generated values
# ‚úÖ Configure Redis for session storage
# ‚úÖ Set up monitoring/alerting for metrics endpoint
# ‚úÖ Configure firewall rules (allow only necessary ports)
# ‚úÖ Enable TLS/HTTPS (required for OAuth)
# ‚úÖ Set up log aggregation (CloudWatch, DataDog, etc.)
# ‚úÖ Configure backup strategy for token storage
# ‚úÖ Test graceful shutdown behavior
# ‚úÖ Verify CORS origins are correctly whitelisted
# ‚úÖ Set up health check monitoring
#
# Environment Variables Priority (highest to lowest):
# 1. System environment variables
# 2. .env file
# 3. Default values in src/config/env.ts
#
# Security Best Practices:
# - Use secret management (AWS Secrets Manager, HashiCorp Vault, etc.)
# - Rotate secrets regularly (90 days recommended)
# - Never commit .env files to version control
# - Use HTTPS/TLS for all production traffic
# - Enable request signing for API authentication
# - Monitor for suspicious activity in logs
# - Implement rate limiting at load balancer level
# - Use Redis with authentication and TLS
#
# Performance Tuning:
# - Adjust batch sizes based on typical request patterns
# - Monitor circuit breaker trips and adjust thresholds
# - Use Redis for caching in high-traffic deployments
# - Enable adaptive batching for variable load
# - Consider read replicas for Google Sheets API if needed
#
# Monitoring:
# - Prometheus metrics: http://localhost:9090/metrics
# - Health check: http://localhost:3000/health
# - Logs: Structured JSON to stdout/stderr
# - OpenTelemetry traces: Configure OTEL_EXPORTER_* env vars
#
# For detailed deployment guide, see: docs/guides/DEPLOYMENT.md
# For security guide, see: docs/development/SECURITY.md
